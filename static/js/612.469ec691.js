"use strict";(self["webpackChunkpdf_image_web"]=self["webpackChunkpdf_image_web"]||[]).push([[612],{1322:function(e,a,l){function t(e){if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,t)).toFixed(2))+" "+l[t]}function r(e,a){const l="."+e.name.split(".").pop().toLowerCase();return a.includes(l)}function o(e,a=104857600){return e.size<=a}l.d(a,{nJ:function(){return i},v7:function(){return t}});const n={PDF:[".pdf"],IMAGE:[".jpg",".jpeg",".png",".bmp",".tiff"],WORD:[".doc",".docx"],EXCEL:[".xls",".xlsx"],POWERPOINT:[".ppt",".pptx"]};function i(e,a){const l=[];return r(e,n[a])||l.push(`文件类型不支持，请上传${n[a].join("、")}格式的文件`),o(e)||l.push("文件大小不能超过100MB"),{valid:0===l.length,errors:l}}},4612:function(e,a,l){l.r(a),l.d(a,{default:function(){return C}});var t=l(641),r=l(33),o=l(953),n=l(163),i=l(8548),s=l(7196),u=l(1322),d=l(784);const p={class:"pdf-watermark"},c={class:"watermark-container"},m={class:"pdf-preview-section"},k={class:"card-header"},f={class:"preview-controls"},v={key:0,class:"pdf-upload-area"},w={key:1,class:"pdf-viewer-container"},g=["src"],y={key:0,class:"pdf-placeholder"},b={class:"watermark-settings-section"},F={class:"card-header"},x={key:0,class:"result-section"},h={class:"result-info"};var _={__name:"PdfWatermark",setup(e){let a=null;const l=async()=>{if(!a){if(window.pdfjsLib)return a=window.pdfjsLib,a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js",a;const e=document.createElement("script");return e.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js",e.async=!0,new Promise((l,t)=>{e.onload=()=>{a=window.pdfjsLib,a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js",l(a)},e.onerror=e=>{console.error("PDF.js load failed:",e),t(e)},document.head.appendChild(e)})}return a},_=(0,o.KR)(),L=(0,o.KR)(),T=(0,o.KR)(),C=(0,o.KR)(),P=(0,o.KR)(!1),W=(0,o.KR)(null),D=(0,o.KR)(null),R=(0,o.KR)(""),E=(0,o.KR)(null),S=(0,o.KR)(null),j=(0,o.KR)(1),z=(0,o.KR)(0),M=(0,o.KR)(1),V=(0,o.KR)(!1),K=(0,o.KR)({x:0,y:0}),X=(0,o.KR)({x:50,y:50}),I=(0,o.Kh)({watermarkType:"text",watermarkText:"",position:"center",opacity:.5,textColor:"#FF0000",fontSize:48,rotation:0,offsetX:0,offsetY:0}),U=(0,t.EW)(()=>!!W.value&&(!("text"===I.watermarkType&&!I.watermarkText.trim())&&!("image"===I.watermarkType&&!D.value))),B=(0,t.EW)(()=>"text"===I.watermarkType&&I.watermarkText?{position:"absolute",left:`${X.value.x}%`,top:`${X.value.y}%`,transform:`translate(-50%, -50%) rotate(${I.rotation}deg)`,color:I.textColor,fontSize:`${I.fontSize}px`,opacity:I.opacity,pointerEvents:"auto",userSelect:"none",whiteSpace:"nowrap",zIndex:10,fontFamily:"Arial, sans-serif",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)",cursor:"move"}:{}),$=(0,t.EW)(()=>"image"===I.watermarkType&&D.value?{position:"absolute",left:`${X.value.x}%`,top:`${X.value.y}%`,transform:`translate(-50%, -50%) rotate(${I.rotation}deg)`,opacity:I.opacity,pointerEvents:"auto",userSelect:"none",zIndex:10,cursor:"move",maxWidth:"200px",maxHeight:"200px"}:{}),A=()=>{I.watermarkText="",D.value=null,R.value="",L.value?.clearFiles()},G=async e=>{const a=(0,u.nJ)(e.raw,"PDF");if(!a.valid)return n.nk.error(a.errors[0]),void _.value.clearFiles();W.value=e.raw,await O(e.raw)},O=async e=>{try{const a=await l();if(!a)throw new Error("PDF.js library load failed");const t=await e.arrayBuffer(),r=await a.getDocument(t).promise;S.value=r,z.value=r.numPages,j.value=1,await Q(1),n.nk.success("PDF loaded successfully")}catch(a){console.error("PDF load failed:",a),a.message.includes("PDF.js library load failed")?n.nk.error("PDF preview function temporarily unavailable, please try again later"):n.nk.error("PDF load failed, please check file format")}},Q=async e=>{if(S.value)try{const a=await S.value.getPage(e),l=T.value,t=l.getContext("2d"),r=a.getViewport({scale:M.value});l.height=r.height,l.width=r.width;const o={canvasContext:t,viewport:r};await a.render(o).promise}catch(a){console.error("Page render failed:",a),n.nk.error("Page render failed")}},J=async()=>{j.value>1&&(j.value--,await Q(j.value))},Y=async()=>{j.value<z.value&&(j.value++,await Q(j.value))},q=async()=>{M.value=1,await Q(j.value)},N=async()=>{if(W.value){S.value=null,a=null,window.pdfjsLib=null;const e=document.querySelector('script[src*="pdf.min.js"]');e&&e.remove(),await O(W.value)}},H=e=>{e.preventDefault(),V.value=!0,K.value={x:e.clientX,y:e.clientY},document.addEventListener("mousemove",Z),document.addEventListener("mouseup",ee)},Z=e=>{if(!V.value)return;const a=C.value.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*100,t=(e.clientY-a.top)/a.height*100;X.value={x:Math.max(0,Math.min(100,l)),y:Math.max(0,Math.min(100,t))}},ee=()=>{V.value=!1,document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",ee)},ae=e=>{("text"===I.watermarkType&&I.watermarkText||"image"===I.watermarkType&&D.value)&&H(e)},le=e=>{V.value&&Z(e)},te=()=>{ee()},re=e=>{const a=(0,u.nJ)(e.raw,"IMAGE");if(!a.valid)return n.nk.error(a.errors[0]),void L.value.clearFiles();D.value=e.raw;const l=new FileReader;l.onload=e=>{R.value=e.target.result},l.readAsDataURL(e.raw)},oe=e=>{const a=(0,u.nJ)(e,"PDF");return a.valid||n.nk.error(a.errors[0]),!1},ne=e=>{const a=(0,u.nJ)(e,"IMAGE");return a.valid||n.nk.error(a.errors[0]),!1},ie=e=>`${Math.round(100*e)}%`,se=e=>`${e}px`,ue=e=>`${e}°`,de=async()=>{if(U.value){P.value=!0;try{const e=new FormData;e.append("file",W.value),e.append("watermarkType",I.watermarkType),e.append("opacity",I.opacity.toString()),"text"===I.watermarkType?(e.append("watermarkText",I.watermarkText),e.append("textColor",I.textColor),e.append("fontSize",I.fontSize.toString()),e.append("rotation",I.rotation.toString()),e.append("position","custom"),e.append("offsetX",X.value.x.toString()),e.append("offsetY",X.value.y.toString())):"image"===I.watermarkType&&D.value&&(e.append("watermarkFile",D.value),e.append("position","custom"),e.append("offsetX",X.value.x.toString()),e.append("offsetY",X.value.y.toString()),e.append("rotation",I.rotation.toString()));const a=await s.DC.addWatermark(e);E.value=a,n.nk.success("PDF watermark added successfully")}catch(e){console.error("PDF watermark add failed:",e),n.nk.error("PDF watermark add failed, please try again")}finally{P.value=!1}}else n.nk.warning("Please complete all required fields")},pe=()=>{if(E.value?.data?.downloadUrl)try{const e=E.value.data.watermarkedFile||"watermarked.pdf";(0,d.downloadFile)(E.value.data.downloadUrl,e),n.nk.success("Download started")}catch(e){console.error("Download failed:",e),n.nk.error("Download failed, please try again")}else n.nk.warning("No file available for download")},ce=()=>{I.watermarkType="text",I.watermarkText="",I.position="center",I.opacity=.5,I.textColor="#FF0000",I.fontSize=48,I.rotation=0,I.offsetX=0,I.offsetY=0,W.value=null,D.value=null,R.value="",E.value=null,S.value=null,j.value=1,z.value=0,X.value={x:50,y:50},_.value?.clearFiles(),L.value?.clearFiles()};return(e,a)=>{const l=(0,t.g2)("el-button"),n=(0,t.g2)("el-button-group"),s=(0,t.g2)("el-icon"),u=(0,t.g2)("el-upload"),d=(0,t.g2)("el-card"),W=(0,t.g2)("el-radio"),M=(0,t.g2)("el-radio-group"),V=(0,t.g2)("el-form-item"),K=(0,t.g2)("el-input"),X=(0,t.g2)("el-color-picker"),O=(0,t.g2)("el-slider"),Q=(0,t.g2)("el-form"),Z=(0,t.g2)("el-divider"),ee=(0,t.g2)("el-alert");return(0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("div",c,[(0,t.Lk)("div",m,[(0,t.bF)(d,{class:"preview-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",k,[a[9]||(a[9]=(0,t.Lk)("span",null,"PDF Preview",-1)),(0,t.Lk)("div",f,[(0,t.bF)(n,null,{default:(0,t.k6)(()=>[(0,t.bF)(l,{disabled:j.value<=1,onClick:J,size:"small"},{default:(0,t.k6)(()=>[...a[6]||(a[6]=[(0,t.eW)(" Previous ",-1)])]),_:1},8,["disabled"]),(0,t.bF)(l,{size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)(j.value)+" / "+(0,r.v_)(z.value),1)]),_:1}),(0,t.bF)(l,{disabled:j.value>=z.value,onClick:Y,size:"small"},{default:(0,t.k6)(()=>[...a[7]||(a[7]=[(0,t.eW)(" Next ",-1)])]),_:1},8,["disabled"])]),_:1}),(0,t.bF)(l,{onClick:q,size:"small",style:{"margin-left":"10px"}},{default:(0,t.k6)(()=>[...a[8]||(a[8]=[(0,t.eW)(" Reset Zoom ",-1)])]),_:1})])])]),default:(0,t.k6)(()=>[S.value?((0,t.uX)(),(0,t.CE)("div",w,[(0,t.Lk)("div",{ref_key:"pdfViewer",ref:C,class:"pdf-viewer",onMousedown:ae,onMousemove:le,onMouseup:te,onMouseleave:te},[S.value?((0,t.uX)(),(0,t.CE)("canvas",{key:0,ref_key:"pdfCanvas",ref:T,class:"pdf-canvas"},null,512)):(0,t.Q3)("",!0),"text"===I.watermarkType&&I.watermarkText&&S.value?((0,t.uX)(),(0,t.CE)("div",{key:1,class:"watermark-preview text-watermark",style:(0,r.Tr)(B.value),onMousedown:H},(0,r.v_)(I.watermarkText),37)):(0,t.Q3)("",!0),"image"===I.watermarkType&&D.value&&S.value?((0,t.uX)(),(0,t.CE)("div",{key:2,class:"watermark-preview image-watermark",style:(0,r.Tr)($.value),onMousedown:H},[(0,t.Lk)("img",{src:R.value,alt:"Watermark Image",class:"watermark-image"},null,8,g)],36)):(0,t.Q3)("",!0)],544),S.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",y,[(0,t.bF)(s,{size:"48"},{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(i.Document))]),_:1}),a[13]||(a[13]=(0,t.Lk)("p",null,"PDF preview loading...",-1)),a[14]||(a[14]=(0,t.Lk)("p",{class:"placeholder-tip"},"If it takes too long to load, please refresh the page and try again",-1)),(0,t.bF)(l,{onClick:N,type:"primary",size:"small",style:{"margin-top":"10px"}},{default:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.eW)(" Retry Load ",-1)])]),_:1})]))])):((0,t.uX)(),(0,t.CE)("div",v,[(0,t.bF)(u,{ref_key:"uploadRef",ref:_,"auto-upload":!1,limit:1,"on-change":G,"before-upload":oe,accept:".pdf",drag:"",class:"pdf-upload"},{tip:(0,t.k6)(()=>[...a[10]||(a[10]=[(0,t.Lk)("div",{class:"el-upload__tip"}," Only PDF files allowed, max 100MB ",-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(s,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(i.UploadFilled))]),_:1}),a[11]||(a[11]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" Drag PDF file here, or "),(0,t.Lk)("em",null,"click to upload")],-1))]),_:1},512)]))]),_:1})]),(0,t.Lk)("div",b,[(0,t.bF)(d,{class:"settings-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",F,[a[15]||(a[15]=(0,t.Lk)("span",null,"Watermark Settings",-1)),(0,t.bF)(s,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(i.Edit))]),_:1})])]),default:(0,t.k6)(()=>[(0,t.bF)(Q,{model:I,"label-width":"100px",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(V,{label:"Watermark Type",required:""},{default:(0,t.k6)(()=>[(0,t.bF)(M,{modelValue:I.watermarkType,"onUpdate:modelValue":a[0]||(a[0]=e=>I.watermarkType=e),onChange:A},{default:(0,t.k6)(()=>[(0,t.bF)(W,{label:"text"},{default:(0,t.k6)(()=>[...a[16]||(a[16]=[(0,t.eW)("Text Watermark",-1)])]),_:1}),(0,t.bF)(W,{label:"image"},{default:(0,t.k6)(()=>[...a[17]||(a[17]=[(0,t.eW)("Image Watermark",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"text"===I.watermarkType?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)(V,{label:"Watermark Text",required:""},{default:(0,t.k6)(()=>[(0,t.bF)(K,{modelValue:I.watermarkText,"onUpdate:modelValue":a[1]||(a[1]=e=>I.watermarkText=e),placeholder:"Enter watermark text",clearable:""},null,8,["modelValue"])]),_:1}),(0,t.bF)(V,{label:"Text Color"},{default:(0,t.k6)(()=>[(0,t.bF)(X,{modelValue:I.textColor,"onUpdate:modelValue":a[2]||(a[2]=e=>I.textColor=e)},null,8,["modelValue"]),(0,t.Lk)("span",{class:"color-preview",style:(0,r.Tr)({backgroundColor:I.textColor})},null,4)]),_:1}),(0,t.bF)(V,{label:"Font Size"},{default:(0,t.k6)(()=>[(0,t.bF)(O,{modelValue:I.fontSize,"onUpdate:modelValue":a[3]||(a[3]=e=>I.fontSize=e),min:12,max:120,step:2,"show-input":"","format-tooltip":se},null,8,["modelValue"])]),_:1}),(0,t.bF)(V,{label:"Text Angle"},{default:(0,t.k6)(()=>[(0,t.bF)(O,{modelValue:I.rotation,"onUpdate:modelValue":a[4]||(a[4]=e=>I.rotation=e),min:0,max:360,step:15,"show-input":"","format-tooltip":ue},null,8,["modelValue"])]),_:1}),(0,t.bF)(V,{label:"Opacity"},{default:(0,t.k6)(()=>[(0,t.bF)(O,{modelValue:I.opacity,"onUpdate:modelValue":a[5]||(a[5]=e=>I.opacity=e),min:.1,max:1,step:.1,"show-input":"","format-tooltip":ie},null,8,["modelValue"])]),_:1})],64)):(0,t.Q3)("",!0),"image"===I.watermarkType?((0,t.uX)(),(0,t.Wv)(V,{key:1,label:"Watermark Image",required:""},{default:(0,t.k6)(()=>[(0,t.bF)(u,{ref_key:"watermarkUploadRef",ref:L,"auto-upload":!1,limit:1,"on-change":re,"before-upload":ne,accept:".jpg,.jpeg,.png,.bmp,.tiff",drag:""},{tip:(0,t.k6)(()=>[...a[18]||(a[18]=[(0,t.Lk)("div",{class:"el-upload__tip"}," Supports JPG, PNG, BMP, TIFF format images ",-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(s,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(i.UploadFilled))]),_:1}),a[19]||(a[19]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" Drag watermark image here, or "),(0,t.Lk)("em",null,"click to upload")],-1))]),_:1},512)]),_:1})):(0,t.Q3)("",!0),(0,t.bF)(V,null,{default:(0,t.k6)(()=>[(0,t.bF)(l,{type:"primary",loading:P.value,disabled:!U.value,onClick:de,size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)(P.value?"Processing...":"Add Watermark"),1)]),_:1},8,["loading","disabled"]),(0,t.bF)(l,{onClick:ce,size:"small"},{default:(0,t.k6)(()=>[...a[20]||(a[20]=[(0,t.eW)("Reset",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),E.value?((0,t.uX)(),(0,t.CE)("div",x,[(0,t.bF)(Z,null,{default:(0,t.k6)(()=>[...a[21]||(a[21]=[(0,t.eW)("Processing Results",-1)])]),_:1}),(0,t.bF)(ee,{title:E.value.msg,type:"success",closable:!1,"show-icon":""},null,8,["title"]),(0,t.Lk)("div",h,[(0,t.Lk)("p",null,[a[22]||(a[22]=(0,t.Lk)("strong",null,"Task ID:",-1)),(0,t.eW)(" "+(0,r.v_)(E.value.data.taskId),1)]),(0,t.Lk)("p",null,[a[23]||(a[23]=(0,t.Lk)("strong",null,"Processed File:",-1)),(0,t.eW)(" "+(0,r.v_)(E.value.data.watermarkedFile),1)]),(0,t.bF)(l,{type:"success",onClick:pe,size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(s,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(i.Download))]),_:1}),a[24]||(a[24]=(0,t.eW)(" Download Result ",-1))]),_:1})])])):(0,t.Q3)("",!0)]),_:1})])]),a[25]||(a[25]=(0,t.Lk)("section",{class:"info-block"},[(0,t.Lk)("h2",null,"Feature Description"),(0,t.Lk)("p",null,"Add text or image watermarks to PDFs with configurable position, opacity, rotation angle, and tiling/repeat options."),(0,t.Lk)("h3",null,"Use Cases"),(0,t.Lk)("ul",null,[(0,t.Lk)("li",null,'Add "Confidential" watermarks to internal documents to prevent leakage.'),(0,t.Lk)("li",null,"Overlay company logo watermarks on contracts for ownership marking."),(0,t.Lk)("li",null,"Batch watermark training materials with copyright statements.")])],-1))])}}},L=l(6262);const T=(0,L.A)(_,[["__scopeId","data-v-3569d2f2"]]);var C=T}}]);
//# sourceMappingURL=612.469ec691.js.map