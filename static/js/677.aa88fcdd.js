"use strict";(self["webpackChunkpdf_image_web"]=self["webpackChunkpdf_image_web"]||[]).push([[677],{784:function(e,a,t){t.r(a),t.d(a,{downloadFile:function(){return r},getApiBaseUrl:function(){return o},getDownloadUrl:function(){return l}});const l=e=>e?e.startsWith("http://")||e.startsWith("https://")?e:window.APP_CONFIG&&window.APP_CONFIG.API_FULL_URL?`${window.APP_CONFIG.API_FULL_URL}${e}`:`https://api.openai2025.com${e}`:"",r=(e,a="")=>{if(!e)return void console.error("Download URL is required");const t=l(e);try{const e=document.createElement("a");e.href=t,e.target="_blank",a&&(e.download=a),document.body.appendChild(e),e.click(),document.body.removeChild(e),console.log("Download started:",t)}catch(r){throw console.error("Download failed:",r),r}},o=()=>window.APP_CONFIG&&window.APP_CONFIG.API_FULL_URL?window.APP_CONFIG.API_FULL_URL:"https://api.openai2025.com"},1322:function(e,a,t){function l(e){if(0===e)return"0 B";const a=1024,t=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+t[l]}function r(e,a){const t="."+e.name.split(".").pop().toLowerCase();return a.includes(t)}function o(e,a=104857600){return e.size<=a}function n(e){return new Promise((a,t)=>{const l=new FileReader;l.onload=e=>a(e.target.result),l.onerror=t,l.readAsDataURL(e)})}t.d(a,{nJ:function(){return u},oz:function(){return n},v7:function(){return l}});const s={PDF:[".pdf"],IMAGE:[".jpg",".jpeg",".png",".bmp",".tiff"],WORD:[".doc",".docx"],EXCEL:[".xls",".xlsx"],POWERPOINT:[".ppt",".pptx"]};function u(e,a){const t=[];return r(e,s[a])||t.push(`文件类型不支持，请上传${s[a].join("、")}格式的文件`),o(e)||t.push("文件大小不能超过100MB"),{valid:0===t.length,errors:t}}},8677:function(e,a,t){t.r(a),t.d(a,{default:function(){return W}});var l=t(641),r=t(33),o=t(953),n=t(163),s=t(8548),u=t(7196),i=t(1322),d=t(784);const c={class:"pdf-watermark"},p={class:"watermark-container"},m={class:"pdf-preview-section"},v={class:"card-header"},f={class:"preview-controls"},k={key:0,class:"pdf-upload-area"},w={key:1,class:"pdf-viewer-container"},F=["src"],b={key:0,class:"pdf-placeholder"},g={class:"watermark-settings-section"},y={class:"card-header"},_={key:0,class:"result-section"},x={class:"result-info"};var h={__name:"PdfWatermark",setup(e){let a=null;const t=async()=>{if(!a){if(window.pdfjsLib)return a=window.pdfjsLib,a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js",a;const e=document.createElement("script");return e.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js",e.async=!0,new Promise((t,l)=>{e.onload=()=>{a=window.pdfjsLib,a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js",t(a)},e.onerror=e=>{console.error("PDF.js加载失败:",e),l(e)},document.head.appendChild(e)})}return a},h=(0,o.KR)(),L=(0,o.KR)(),P=(0,o.KR)(),C=(0,o.KR)(),T=(0,o.KR)(!1),R=(0,o.KR)(null),D=(0,o.KR)(null),W=(0,o.KR)(""),E=(0,o.KR)(null),j=(0,o.KR)(null),S=(0,o.KR)(1),U=(0,o.KR)(0),z=(0,o.KR)(1),M=(0,o.KR)(!1),I=(0,o.KR)({x:0,y:0}),V=(0,o.KR)({x:50,y:50}),A=(0,o.Kh)({watermarkType:"text",watermarkText:"",position:"center",opacity:.5,textColor:"#FF0000",fontSize:48,rotation:0,offsetX:0,offsetY:0}),K=(0,l.EW)(()=>!!R.value&&(!("text"===A.watermarkType&&!A.watermarkText.trim())&&!("image"===A.watermarkType&&!D.value))),X=(0,l.EW)(()=>"text"===A.watermarkType&&A.watermarkText?{position:"absolute",left:`${V.value.x}%`,top:`${V.value.y}%`,transform:`translate(-50%, -50%) rotate(${A.rotation}deg)`,color:A.textColor,fontSize:`${A.fontSize}px`,opacity:A.opacity,pointerEvents:"auto",userSelect:"none",whiteSpace:"nowrap",zIndex:10,fontFamily:"Arial, sans-serif",fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.3)",cursor:"move"}:{}),G=(0,l.EW)(()=>"image"===A.watermarkType&&D.value?{position:"absolute",left:`${V.value.x}%`,top:`${V.value.y}%`,transform:`translate(-50%, -50%) rotate(${A.rotation}deg)`,opacity:A.opacity,pointerEvents:"auto",userSelect:"none",zIndex:10,cursor:"move",maxWidth:"200px",maxHeight:"200px"}:{}),$=()=>{A.watermarkText="",D.value=null,W.value="",L.value?.clearFiles()},B=async e=>{const a=(0,i.nJ)(e.raw,"PDF");if(!a.valid)return n.nk.error(a.errors[0]),void h.value.clearFiles();R.value=e.raw,await O(e.raw)},O=async e=>{try{const a=await t();if(!a)throw new Error("PDF.js库加载失败");const l=await e.arrayBuffer(),r=await a.getDocument(l).promise;j.value=r,U.value=r.numPages,S.value=1,await N(1),n.nk.success("PDF加载成功")}catch(a){console.error("PDF加载失败:",a),a.message.includes("PDF.js库加载失败")?n.nk.error("PDF预览功能暂时不可用，请稍后重试"):n.nk.error("PDF加载失败，请检查文件格式")}},N=async e=>{if(j.value)try{const a=await j.value.getPage(e),t=P.value,l=t.getContext("2d"),r=a.getViewport({scale:z.value});t.height=r.height,t.width=r.width;const o={canvasContext:l,viewport:r};await a.render(o).promise}catch(t){if(console.error("页面渲染失败:",t),t.message&&t.message.includes("private member")){console.log("检测到PDF.js版本兼容性问题，尝试重新加载..."),a=null,window.pdfjsLib=null;const e=document.querySelector('script[src*="pdf.min.js"]');e&&e.remove();try{await O(R.value)}catch(l){console.error("重新加载失败:",l),n.nk.error("PDF预览功能暂时不可用，请刷新页面重试")}}else n.nk.error("页面渲染失败")}},Q=async()=>{S.value>1&&(S.value--,await N(S.value))},q=async()=>{S.value<U.value&&(S.value++,await N(S.value))},J=async()=>{z.value=1,await N(S.value)},Y=async()=>{if(R.value){j.value=null,a=null,window.pdfjsLib=null;const e=document.querySelector('script[src*="pdf.min.js"]');e&&e.remove(),await O(R.value)}},H=e=>{e.preventDefault(),M.value=!0,I.value={x:e.clientX,y:e.clientY},document.addEventListener("mousemove",Z),document.addEventListener("mouseup",ee)},Z=e=>{if(!M.value)return;const a=C.value.getBoundingClientRect(),t=(e.clientX-a.left)/a.width*100,l=(e.clientY-a.top)/a.height*100;V.value={x:Math.max(0,Math.min(100,t)),y:Math.max(0,Math.min(100,l))}},ee=()=>{M.value=!1,document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",ee)},ae=e=>{("text"===A.watermarkType&&A.watermarkText||"image"===A.watermarkType&&D.value)&&H(e)},te=e=>{M.value&&Z(e)},le=()=>{ee()},re=e=>{const a=(0,i.nJ)(e.raw,"IMAGE");if(!a.valid)return n.nk.error(a.errors[0]),void L.value.clearFiles();D.value=e.raw;const t=new FileReader;t.onload=e=>{W.value=e.target.result},t.readAsDataURL(e.raw)},oe=e=>{const a=(0,i.nJ)(e,"PDF");return a.valid||n.nk.error(a.errors[0]),!1},ne=e=>{const a=(0,i.nJ)(e,"IMAGE");return a.valid||n.nk.error(a.errors[0]),!1},se=e=>`${Math.round(100*e)}%`,ue=e=>`${e}px`,ie=e=>`${e}°`,de=async()=>{if(K.value){T.value=!0;try{const e=new FormData;e.append("file",R.value),e.append("watermarkType",A.watermarkType),e.append("opacity",A.opacity.toString()),"text"===A.watermarkType?(e.append("watermarkText",A.watermarkText),e.append("textColor",A.textColor),e.append("fontSize",A.fontSize.toString()),e.append("rotation",A.rotation.toString()),e.append("position","custom"),e.append("offsetX",V.value.x.toString()),e.append("offsetY",V.value.y.toString())):"image"===A.watermarkType&&D.value&&(e.append("watermarkFile",D.value),e.append("position","custom"),e.append("offsetX",V.value.x.toString()),e.append("offsetY",V.value.y.toString()),e.append("rotation",A.rotation.toString()));const a=await u.DC.addWatermark(e);E.value=a,n.nk.success("PDF水印添加成功")}catch(e){console.error("PDF水印添加失败:",e),n.nk.error("PDF水印添加失败，请重试")}finally{T.value=!1}}else n.nk.warning("请完善所有必填项")},ce=()=>{if(E.value?.data?.downloadUrl)try{const e=E.value.data.watermarkedFile||"watermarked.pdf";(0,d.downloadFile)(E.value.data.downloadUrl,e),n.nk.success("下载已开始")}catch(e){console.error("下载失败:",e),n.nk.error("下载失败，请重试")}else n.nk.warning("没有可下载的文件")},pe=()=>{A.watermarkType="text",A.watermarkText="",A.position="center",A.opacity=.5,A.textColor="#FF0000",A.fontSize=48,A.rotation=0,A.offsetX=0,A.offsetY=0,R.value=null,D.value=null,W.value="",E.value=null,j.value=null,S.value=1,U.value=0,V.value={x:50,y:50},h.value?.clearFiles(),L.value?.clearFiles()};return(e,a)=>{const t=(0,l.g2)("el-button"),n=(0,l.g2)("el-button-group"),u=(0,l.g2)("el-icon"),i=(0,l.g2)("el-upload"),d=(0,l.g2)("Document"),R=(0,l.g2)("el-card"),z=(0,l.g2)("el-radio"),M=(0,l.g2)("el-radio-group"),I=(0,l.g2)("el-form-item"),V=(0,l.g2)("el-input"),O=(0,l.g2)("el-color-picker"),N=(0,l.g2)("el-slider"),Z=(0,l.g2)("el-form"),ee=(0,l.g2)("el-divider"),me=(0,l.g2)("el-alert");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",p,[(0,l.Lk)("div",m,[(0,l.bF)(R,{class:"preview-card"},{header:(0,l.k6)(()=>[(0,l.Lk)("div",v,[a[9]||(a[9]=(0,l.Lk)("span",null,"PDF预览",-1)),(0,l.Lk)("div",f,[(0,l.bF)(n,null,{default:(0,l.k6)(()=>[(0,l.bF)(t,{disabled:S.value<=1,onClick:Q,size:"small"},{default:(0,l.k6)(()=>[...a[6]||(a[6]=[(0,l.eW)(" 上一页 ",-1)])]),_:1},8,["disabled"]),(0,l.bF)(t,{size:"small"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(S.value)+" / "+(0,r.v_)(U.value),1)]),_:1}),(0,l.bF)(t,{disabled:S.value>=U.value,onClick:q,size:"small"},{default:(0,l.k6)(()=>[...a[7]||(a[7]=[(0,l.eW)(" 下一页 ",-1)])]),_:1},8,["disabled"])]),_:1}),(0,l.bF)(t,{onClick:J,size:"small",style:{"margin-left":"10px"}},{default:(0,l.k6)(()=>[...a[8]||(a[8]=[(0,l.eW)(" 重置缩放 ",-1)])]),_:1})])])]),default:(0,l.k6)(()=>[j.value?((0,l.uX)(),(0,l.CE)("div",w,[(0,l.Lk)("div",{ref_key:"pdfViewer",ref:C,class:"pdf-viewer",onMousedown:ae,onMousemove:te,onMouseup:le,onMouseleave:le},[j.value?((0,l.uX)(),(0,l.CE)("canvas",{key:0,ref_key:"pdfCanvas",ref:P,class:"pdf-canvas"},null,512)):(0,l.Q3)("",!0),"text"===A.watermarkType&&A.watermarkText&&j.value?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"watermark-preview text-watermark",style:(0,r.Tr)(X.value),onMousedown:H},(0,r.v_)(A.watermarkText),37)):(0,l.Q3)("",!0),"image"===A.watermarkType&&D.value&&j.value?((0,l.uX)(),(0,l.CE)("div",{key:2,class:"watermark-preview image-watermark",style:(0,r.Tr)(G.value),onMousedown:H},[(0,l.Lk)("img",{src:W.value,alt:"水印图片",class:"watermark-image"},null,8,F)],36)):(0,l.Q3)("",!0)],544),j.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",b,[(0,l.bF)(u,{size:"48"},{default:(0,l.k6)(()=>[(0,l.bF)(d)]),_:1}),a[13]||(a[13]=(0,l.Lk)("p",null,"PDF预览功能加载中...",-1)),a[14]||(a[14]=(0,l.Lk)("p",{class:"placeholder-tip"},"如果长时间无法加载，请刷新页面重试",-1)),(0,l.bF)(t,{onClick:Y,type:"primary",size:"small",style:{"margin-top":"10px"}},{default:(0,l.k6)(()=>[...a[12]||(a[12]=[(0,l.eW)(" 重试加载 ",-1)])]),_:1})]))])):((0,l.uX)(),(0,l.CE)("div",k,[(0,l.bF)(i,{ref_key:"uploadRef",ref:h,"auto-upload":!1,limit:1,"on-change":B,"before-upload":oe,accept:".pdf",drag:"",class:"pdf-upload"},{tip:(0,l.k6)(()=>[...a[10]||(a[10]=[(0,l.Lk)("div",{class:"el-upload__tip"}," 只能上传PDF文件，且不超过100MB ",-1)])]),default:(0,l.k6)(()=>[(0,l.bF)(u,{class:"el-icon--upload"},{default:(0,l.k6)(()=>[(0,l.bF)((0,o.R1)(s.UploadFilled))]),_:1}),a[11]||(a[11]=(0,l.Lk)("div",{class:"el-upload__text"},[(0,l.eW)(" 将PDF文件拖到此处，或"),(0,l.Lk)("em",null,"点击上传")],-1))]),_:1},512)]))]),_:1})]),(0,l.Lk)("div",g,[(0,l.bF)(R,{class:"settings-card"},{header:(0,l.k6)(()=>[(0,l.Lk)("div",y,[a[15]||(a[15]=(0,l.Lk)("span",null,"水印设置",-1)),(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,o.R1)(s.Edit))]),_:1})])]),default:(0,l.k6)(()=>[(0,l.bF)(Z,{model:A,"label-width":"100px",size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(I,{label:"水印类型",required:""},{default:(0,l.k6)(()=>[(0,l.bF)(M,{modelValue:A.watermarkType,"onUpdate:modelValue":a[0]||(a[0]=e=>A.watermarkType=e),onChange:$},{default:(0,l.k6)(()=>[(0,l.bF)(z,{label:"text"},{default:(0,l.k6)(()=>[...a[16]||(a[16]=[(0,l.eW)("文字水印",-1)])]),_:1}),(0,l.bF)(z,{label:"image"},{default:(0,l.k6)(()=>[...a[17]||(a[17]=[(0,l.eW)("图片水印",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"text"===A.watermarkType?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.bF)(I,{label:"水印文字",required:""},{default:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:A.watermarkText,"onUpdate:modelValue":a[1]||(a[1]=e=>A.watermarkText=e),placeholder:"请输入水印文字",clearable:""},null,8,["modelValue"])]),_:1}),(0,l.bF)(I,{label:"文字颜色"},{default:(0,l.k6)(()=>[(0,l.bF)(O,{modelValue:A.textColor,"onUpdate:modelValue":a[2]||(a[2]=e=>A.textColor=e)},null,8,["modelValue"]),(0,l.Lk)("span",{class:"color-preview",style:(0,r.Tr)({backgroundColor:A.textColor})},null,4)]),_:1}),(0,l.bF)(I,{label:"字体大小"},{default:(0,l.k6)(()=>[(0,l.bF)(N,{modelValue:A.fontSize,"onUpdate:modelValue":a[3]||(a[3]=e=>A.fontSize=e),min:12,max:120,step:2,"show-input":"","format-tooltip":ue},null,8,["modelValue"])]),_:1}),(0,l.bF)(I,{label:"文字角度"},{default:(0,l.k6)(()=>[(0,l.bF)(N,{modelValue:A.rotation,"onUpdate:modelValue":a[4]||(a[4]=e=>A.rotation=e),min:0,max:360,step:15,"show-input":"","format-tooltip":ie},null,8,["modelValue"])]),_:1}),(0,l.bF)(I,{label:"透明度"},{default:(0,l.k6)(()=>[(0,l.bF)(N,{modelValue:A.opacity,"onUpdate:modelValue":a[5]||(a[5]=e=>A.opacity=e),min:.1,max:1,step:.1,"show-input":"","format-tooltip":se},null,8,["modelValue"])]),_:1})],64)):(0,l.Q3)("",!0),"image"===A.watermarkType?((0,l.uX)(),(0,l.Wv)(I,{key:1,label:"水印图片",required:""},{default:(0,l.k6)(()=>[(0,l.bF)(i,{ref_key:"watermarkUploadRef",ref:L,"auto-upload":!1,limit:1,"on-change":re,"before-upload":ne,accept:".jpg,.jpeg,.png,.bmp,.tiff",drag:""},{tip:(0,l.k6)(()=>[...a[18]||(a[18]=[(0,l.Lk)("div",{class:"el-upload__tip"}," 支持JPG、PNG、BMP、TIFF格式的图片 ",-1)])]),default:(0,l.k6)(()=>[(0,l.bF)(u,{class:"el-icon--upload"},{default:(0,l.k6)(()=>[(0,l.bF)((0,o.R1)(s.UploadFilled))]),_:1}),a[19]||(a[19]=(0,l.Lk)("div",{class:"el-upload__text"},[(0,l.eW)(" 将水印图片拖到此处，或"),(0,l.Lk)("em",null,"点击上传")],-1))]),_:1},512)]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(I,null,{default:(0,l.k6)(()=>[(0,l.bF)(t,{type:"primary",loading:T.value,disabled:!K.value,onClick:de,size:"small"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(T.value?"处理中...":"添加水印"),1)]),_:1},8,["loading","disabled"]),(0,l.bF)(t,{onClick:pe,size:"small"},{default:(0,l.k6)(()=>[...a[20]||(a[20]=[(0,l.eW)("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),E.value?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(ee,null,{default:(0,l.k6)(()=>[...a[21]||(a[21]=[(0,l.eW)("处理结果",-1)])]),_:1}),(0,l.bF)(me,{title:E.value.msg,type:"success",closable:!1,"show-icon":""},null,8,["title"]),(0,l.Lk)("div",x,[(0,l.Lk)("p",null,[a[22]||(a[22]=(0,l.Lk)("strong",null,"任务ID:",-1)),(0,l.eW)(" "+(0,r.v_)(E.value.data.taskId),1)]),(0,l.Lk)("p",null,[a[23]||(a[23]=(0,l.Lk)("strong",null,"处理文件:",-1)),(0,l.eW)(" "+(0,r.v_)(E.value.data.watermarkedFile),1)]),(0,l.bF)(t,{type:"success",onClick:ce,size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,o.R1)(s.Download))]),_:1}),a[24]||(a[24]=(0,l.eW)(" 下载结果 ",-1))]),_:1})])])):(0,l.Q3)("",!0)]),_:1})])])])}}},L=t(6262);const P=(0,L.A)(h,[["__scopeId","data-v-3f4b735a"]]);var C=P;const T={class:"pdf-watermark-page"};var R={__name:"PdfWatermark",setup(e){return(e,a)=>((0,l.uX)(),(0,l.CE)("div",T,[(0,l.bF)(C)]))}};const D=(0,L.A)(R,[["__scopeId","data-v-0c340363"]]);var W=D}}]);
//# sourceMappingURL=677.aa88fcdd.js.map